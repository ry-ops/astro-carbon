---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getCollection } from 'astro:content';

// Get all blog posts from content collection, excluding Docs category and future posts
const now = new Date();
const allPosts = await getCollection('posts', ({ data }) => {
  return data.category !== 'Docs' && data.date <= now;
});

// Sort by date (newest first)
const sortedPosts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Map all posts to article format
const articles = sortedPosts.map(post => ({
  title: post.data.title,
  description: post.data.description,
  category: post.data.category,
  date: post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }),
  author: post.data.author,
  image: post.data.hero?.image || post.data.image,
  href: `/posts/${post.slug}`,
  featured: post.data.featured || false,
}));
---

<Layout title="All Posts | ry-ops">
  <Header />

  <main id="main-content" class="content-constrained px-4 sm:px-6 lg:px-8 py-12" role="main">
    <!-- Page Header -->
    <section class="mb-16 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4" style="color: var(--text-primary);">
        All Posts
      </h1>
      <p class="text-xl max-w-3xl mx-auto text-center" style="color: var(--text-secondary); line-height: var(--line-height-normal);">
        Explore all articles about AI development, autonomous systems, and engineering insights from building Cortex.
      </p>
    </section>

    <!-- All Articles Grid -->
    <section aria-label="All blog posts">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: 3rem;">
        {articles.map((article) => (
          <ArticleCard {...article} />
        ))}
      </div>

      {articles.length === 0 && (
        <div class="text-center py-16" role="status">
          <p class="text-lg" style="color: var(--text-secondary); line-height: var(--line-height-normal);">
            No posts found. Check back soon!
          </p>
        </div>
      )}
    </section>

    <!-- Meet Cortex CTA -->
    <section class="mt-16 rounded-2xl p-8 md:p-12" style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-overlay) 100%); border: 1px solid var(--border-default);" aria-labelledby="cta-heading">
      <div class="max-w-4xl mx-auto text-center">
        <div class="mb-3">
          <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold" style="background-color: var(--accent-emphasis); color: white;">
            Built by ry-ops
          </span>
        </div>
        <h2 id="cta-heading" class="text-3xl md:text-4xl font-bold mb-4" style="color: var(--text-primary);">
          Meet Cortex
        </h2>
        <p class="text-lg mb-6 max-w-2xl mx-auto" style="color: var(--text-secondary); line-height: var(--line-height-normal);">
          A completely autonomous AI orchestration system with unlimited parallel execution and real-time observability. Scales from 1 to 10,000+ specialized agents on-demand.
        </p>
        <div class="flex flex-wrap gap-3 justify-center">
          <a
            href="/meet-cortex"
            class="inline-flex items-center px-6 py-3 rounded-md font-semibold transition-colors posts-cta-primary"
            style="background-color: var(--accent-emphasis); color: white;"
          >
            Discover Cortex
          </a>
          <a
            href="/"
            class="inline-flex items-center px-6 py-3 rounded-md font-semibold transition-colors posts-cta-secondary"
            style="border: 1px solid var(--border-default); color: var(--text-primary);"
          >
            Back to Home
          </a>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* Posts page CTA hover states */
  .posts-cta-primary:hover,
  .posts-cta-primary:focus {
    background-color: var(--accent-primary) !important;
  }

  .posts-cta-secondary:hover,
  .posts-cta-secondary:focus {
    background-color: var(--bg-tertiary);
  }
</style>
